<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Map Bounds Restriction</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
    #map {
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script>
    var data_layer_1;
    var data_layer_2;
    var data_layer_3;
    var dataMarkers = [];
    var userMarkers = [];
    var PORTLAND_OREGON_BOUNDS = {
      north: 45.9140699,
      south: 45.0140702,
      west: -123.405,
      east: -121.909,
    };
    var UNIVPORT = {
      lat: 45.51407,
      lng: -122.7057
    };

    function initMap() {
      var map = new google.maps.Map(document.getElementById('map'), {
        center: UNIVPORT,
        restriction: {
          latLngBounds: PORTLAND_OREGON_BOUNDS,
          strictBounds: true,
        },
        disableDefaultUI: true,
        zoom: 9,
      });

      // Data layer for each filter
      data_layer_1 = new google.maps.Data({map: map});
      data_layer_2 = new google.maps.Data({map: map});
      data_layer_3 = new google.maps.Data({map: map});

      // Create a geoencorder that will translate location details into coordinates
      var geocoder = new google.maps.Geocoder();
      document.getElementById('submitButton').addEventListener('click', function() {
        var getColor = document.getElementById("colorSet");
        var currColor = getColor.options[getColor.selectedIndex].value;
        geocodeAddress(geocoder, map, currColor);
      });
      document.getElementById('apply').addEventListener('click', function() {
        var filterSelect = document.querySelector('input[name = "select2"]:checked').value;
        getFilter(filterSelect, map, dataMarkers);
      });
    } // Close of Initialize Map function

    function geocodeAddress(geocoder, resultsMap, selectedColor) {
      var markerColor = {
        orange: { icon: 'http://maps.google.com/mapfiles/kml/paddle/orange-circle.png' },
        red: { icon: 'http://maps.google.com/mapfiles/kml/paddle/red-circle.png' },
        blue: { icon: 'http://maps.google.com/mapfiles/kml/paddle/ltblu-circle.png'},
        green: { icon: 'http://maps.google.com/mapfiles/kml/paddle/grn-circle.png'}
      }
      var address = document.getElementById('addressID').value;
      geocoder.geocode({
        'address': address
      }, function(results, status) {
        if (status === 'OK') {
          var marker = new google.maps.Marker({
            map: resultsMap,
            position: results[0].geometry.location,
            icon: markerColor[selectedColor].icon
          });
          userMarkers.push(marker);
        } else {
          alert('Address could not be found, please try again.');
        }
      });
    }

    // External Citation: https://stackoverflow.com/questions/23071775/how-to-remove-data-from-a-google-maps-data-layer
    function getFilter(filtOP, map, dataMarkers) {
      if (filtOP == "urm") {
        setData(map, 'https://opendata.arcgis.com/datasets/f833fb14d5494bfa916bbde27be567ac_117.geojson', data_layer_1);
      } else if (filtOP == "tier1") {
        data_layer_2.setStyle({icon: 'http://maps.google.com/mapfiles/kml/shapes/ranger_station.png'});
        setData(map, 'https://opendata.arcgis.com/datasets/3bda4323cddb4d0aa43a94c0c923df6e_39.geojson', data_layer_2);
      } else if (filtOP == "eqcn") {
        data_layer_3.setStyle({icon: 'http://maps.google.com/mapfiles/kml/shapes/earthquake.png'});
        setData(map, 'https://opendata.arcgis.com/datasets/6e6185533d5447deb8b7204c27e1858e_92.geojson', data_layer_3);
      }
    } // end of getFilter function

    function setData(map, url, data_layer) {
      $.getJSON(url, function(data) {
        markers = data_layer.addGeoJson(data);
        if (dataMarkers.length != 0) {
          dataMarkers = [...dataMarkers, ...markers];
        } else {
          dataMarkers = markers;
        }
        google.maps.event.addDomListener(document.getElementById('clear'), 'click', function() {
          for (var i = 0; i < dataMarkers.length; i++)
            data_layer.remove(dataMarkers[i]);
        });

      });
  }
    
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsK-R6-CVye-TJUpkp6IY6_h1KXNH87F4&callback=initMap">
  </script>
</body>
</html>
